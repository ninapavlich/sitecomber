{% extends 'base.html' %}
{% load results_tags %}
{% block bodyclass %}{{block.super}} page-detail{% endblock %}



{% block inner %}

<nav aria-label="breadcrumb" class="my-4">
  <ol class="breadcrumb">
    <li class="breadcrumb-item"><a href="/">All Sites</a></li>
    <li class="breadcrumb-item">
      <a href="{% url 'site-detail' object.site_domain.site.pk %}"
        >{{object.site_domain.site}}</a
      >
    </li>
    <li class="breadcrumb-item active" aria-current="page">{{object.title}}</li>
  </ol>
</nav>
<article class="main">
  <div class="clearfix my-4">
    <div class="float-left">
      <h1 class="h3">{{object.title}}</h1>
      <h2 class="h5 text-secondary">
        <a class="text-secondary" href="{{object.url}}" target="_blank"
          >{{object.url}}</a
        >
      </h2>

      {% if object.latest_request and object.latest_request.response %}
      <span class="text-muted"
        >Last crawled on {{object.latest_request.load_start_time}} {{object.latest_request.load_start_time|date:'e'}}</span
      >
      {% else %}
      <span class="text-muted">Page has not yet been crawled</span> {% endif %}




    </div>


    <a
      href="{{object.url}}"
      target="_blank"
      class="float-right badge badge-info p-2"
      >Visit this page &nearr;</a
    >


  </div>

  <div class="row pb-4">

    <div class="col-md-6">

      {% get_test_result_by_type object "sitecomber_screenshots.tests.LatestScreenshotTest" as latest_screenshot_test %}
      {% if latest_screenshot_test and latest_screenshot_test.success %}
      <div class="screenshot">
        <div class="">
          <a href="{{SETTINGS.MEDIA_URL}}{{latest_screenshot_test.data_json.screenshots.0}}" target="_blank">
            <img src="{{SETTINGS.MEDIA_URL}}{{latest_screenshot_test.data_json.screenshots.0}}" alt="Latest screenshot of {{object.url}}">
          </a>
        </div>
      </div>
      {% endif %}
    </div>
    <div class="col-md-6">
      <h5>Test results for this page:</h5>
      <ul class="list-unstyled p-2">


        {% for result in object.test_results %}
        <li class="my-0 ">


            <span class="h5 font-mono text-{{result.bootstrap_class}}">
              {% if result.bootstrap_class == 'error' %} &#215;
              {% elif result.bootstrap_class == 'warning' %} &#33;
              {% else %} &#10003;{% endif %}

            </span>
            <a href="{% url 'site-test-results' object.site_domain.site.pk %}#{{result.test_title}}" class="text-{{result.bootstrap_class}}" text="View site-wide report for {{result.test_title}}"><strong>{{result.test_title}}</strong></a>
            <span class="font-italic small">{{result.message|safe}}</span>

        </li>
        {% endfor %}


      </ul>
    </div>
  </div>

  <div class="card text-dark">
    <div class="card-header">
      <ul class="nav nav-tabs card-header-tabs" role="tablist">
        {% comment %}
        <li class="nav-item">
          <a
            class="nav-link "
            href="#tests"
            role="tab"
            aria-controls="description"
            aria-selected="true"
            >Results Overview</a
          >
        </li>
        {% endcomment %}
        <li class="nav-item">
          <a
            class="nav-link active"
            href="#links"
            role="tab"
            aria-controls="deals"
            aria-selected="false"
            >Incoming &amp; Outgoing Links</a
          >
        </li>
        <li class="nav-item">
          <a
            class="nav-link"
            href="#article"
            role="tab"
            aria-controls="deals"
            aria-selected="false"
            >Article</a
          >
        </li>
        <li class="nav-item">
          <a
            class="nav-link"
            href="#seo"
            role="tab"
            aria-controls="deals"
            aria-selected="false"
            >SEO</a
          >
        </li>
        {% comment %}
        <li class="nav-item">
          <a
            class="nav-link"
            href="#technical"
            role="tab"
            aria-controls="deals"
            aria-selected="false"
            >Technical</a
          >
        </li>
        <li class="nav-item">
          <a
            class="nav-link"
            href="#accessibility"
            role="tab"
            aria-controls="deals"
            aria-selected="false"
            >Accessibility</a
          >
        </li>
        {% endcomment %}
        <li class="nav-item">
          <a
            class="nav-link"
            href="#request"
            role="tab"
            aria-controls="history"
            aria-selected="false"
            >Request Details</a
          >
        </li>

      </ul>
    </div>
    <div class="card-body">
      <div class="tab-content mt-3">


        <div class="tab-pane " id="article" role="tabpanel">
          {% include 'results/partials/pageresult__article_tab.html' %}
        </div>
        <div class="tab-pane" id="seo" role="tabpanel">
          {% include 'results/partials/pageresult__seo_tab.html' %}
        </div>
        <div class="tab-pane" id="technical" role="tabpanel">
          {% include 'results/partials/pageresult__technical_tab.html' %}
        </div>
        <div class="tab-pane" id="accessibility" role="tabpanel">
          {% include 'results/partials/pageresult__accessibility_tab.html' %}
        </div>
        <div
          class="tab-pane "
          id="request"
          role="tabpanel"
          aria-labelledby="history-tab"
        >
          {% include 'results/partials/pageresult__request_details_tab.html' %}
        </div>

        <div
          class="tab-pane active"
          id="links"
          role="tabpanel"
          aria-labelledby="deals-tab"
        >
          {% include 'results/partials/pageresult__links_tab.html' %}
        </div>
      </div>
    </div>
  </div>
</article>
{% endblock %}
