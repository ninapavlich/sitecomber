{% extends 'base.html' %}

{% block bodyclass %}{{block.super}} page-detail{% endblock %}

{% block inner %}

<nav aria-label="breadcrumb" class="my-4">
  <ol class="breadcrumb">
    <li class="breadcrumb-item"><a href="/">All Sites</a></li>
    <li class="breadcrumb-item"><a href="{% url 'site-detail' object.site_domain.site.pk %}">{{object.site_domain.site}}</a></li>
    <li class="breadcrumb-item active" aria-current="page">{{object.title}}</li>
  </ol>
</nav>

<article class="main">
  <div class="clearfix my-4">
    <div class="float-left">
      <h1 class="h3">{{object.title}}</h1>
      <h2 class="h5 text-secondary"><a class="text-secondary" href="{{object.url}}" target="_blank">{{object.url}}</a></h2>

      {% if object.latest_request and object.latest_request.response %}
      <span class="text-muted">Last crawled on {{object.latest_request.load_start_time}}</span>
      {% else %}
      <span class="text-muted">Page has not yet been crawled</span>
      {% endif %}
    </div>
    <a href="{{object.url}}" target="_blank" class="float-right badge badge-info p-2">Visit</a>
  </div>

  

  <div class="card text-dark">
    <div class="card-header">
      <ul class="nav nav-tabs card-header-tabs" role="tablist">
        <li class="nav-item">
          <a class="nav-link active" href="#tests" role="tab" aria-controls="description" aria-selected="true">Test Results</a>
        </li>

        <li class="nav-item">
          <a class="nav-link" href="#article" role="tab" aria-controls="deals" aria-selected="false">Article</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#seo" role="tab" aria-controls="deals" aria-selected="false">SEO</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#technical" role="tab" aria-controls="deals" aria-selected="false">Technical</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#accessibility" role="tab" aria-controls="deals" aria-selected="false">Accessibility</a>
        </li>

        <li class="nav-item">
          <a class="nav-link"  href="#request" role="tab" aria-controls="history" aria-selected="false">Request Details</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#links" role="tab" aria-controls="deals" aria-selected="false">Incoming &amp; Outgoing Links</a>
        </li>
        

      </ul>
    </div>
    <div class="card-body">
       <div class="tab-content mt-3">



        <div class="tab-pane active" id="tests" role="tabpanel">
          <ul class="list-unstyled">
            {% for result in object.test_results %}
            <li class="p-2 my-2 alert alert-{{result.bootstrap_class}}">
              <strong>{{result.test_title}}</strong> {{result.message}}
            </li>
            {% endfor %}
          </ul>
        </div>


        <div class="tab-pane" id="article" role="tabpanel">
          Aricle TODO
          <div>Article preview and time estimate based on data from test</div>
          <div>List of mis-spelled words</div>
        </div>

        <div class="tab-pane" id="seo" role="tabpanel">
          SEO TODO
          <ul>
            <li>Display page meta tags</li>
            <li>Social media share info</li>
            <li>Duplicate content warning</li>
            <li>Sitemap warning</li>
          </ul>

        </div>

        <div class="tab-pane" id="technical" role="tabpanel">
          Technical TODO
          <ul>
            <li>HTML Validation</li>
            <li>Page speed test via Google API</li>
            <li>Validate server security (certificate, known vulnerabilities)</li>
          </ul>

        </div>

        <div class="tab-pane" id="accessibility" role="tabpanel">
          Accessibility TODO
          <ul>
            <li>Image and video alt text</li>
          </ul>

        </div>
         

        <div class="tab-pane" id="request" role="tabpanel" aria-labelledby="history-tab">  
          {% if object.latest_request %}
          {% if object.latest_request.response %}
          <h4>Request Path</h4>
          <ul class="list-unstyled">
            <li><strong>{{object.latest_request.method}}</strong> on {{object.latest_request.load_start_time}}</li>
            {% for response in object.response_list %}
            <li><strong>{{response.status_code}}</strong> {{response.response_url}} [{{response.content_type}}{% if response.content_length %} - {{response.content_length}}{% endif %}] <em>{{response.time_elapsed_ms}}ms</em></li>
            {% endfor %}
          </ul>
          {% endif %}

          <div class="clearfix mt-4">
            <h4>Request Headers</h4>

            <div class="border rounded bg-light clearfix">
              <dl>
              {% for key, value in object.latest_request.request_header_json.items %}
                <dt>{{key}}</dt>
                <dd>{{value}}</dd>
              {% endfor %}
              </dl>
            </div>
          </div>

          <div class="clearfix mt-4">
            <h4>Response Headers</h4>

            <div class="border rounded bg-light clearfix">

              {% if object.latest_request.response %}
              <dl>
              {% for key, value in object.latest_request.response.response_header_json.items %}
                <dt>{{key}}</dt>
                <dd>{{value}}</dd>
              {% endfor %}
              </dl>
              {% else %}
              <p>Page response hasn't been recorded</p>
              {% endif %}

            </div>
          </div>

          {% if object.latest_request.response.text_content %}
          <h4 class="mt-4">Source</h4>
          <div class="border rounded bg-light p-3">
            <pre>{{object.latest_request.response.enumerated_source}}</pre>
          </div>
          {% endif %}

          {% else %}
          <p>Page hasn't been loaded yet</p>
          {% endif %}
        </div>
         



        <div class="tab-pane" id="links" role="tabpanel" aria-labelledby="deals-tab">
          <h4>Incoming links from within {{object.site_domain.site}}</h4>
          <ul class="list-unstyled">
            {% for link in object.incoming_links_with_prefetch.all %}
            <li class="my-1 clearfix"><a href="{% url 'page-result-detail' link.site_domain.site.pk link.pk %}">{{link.url}} <span class="status-code status-code-{{link.latest_status_code}}" title="{{link.latest_status_code}}"></span></a> <a class="float-right badge badge-info p-2" href="{{link.url}}" target="_blank">Visit</a></li>
            {% empty %}
            <li>No internal links to this page found yet.</li>
            {% endfor %}
          </ul>
          <h4>Outgoing links</h4>
          <ul class="list-unstyled">
            {% for link in object.outgoing_links_with_prefetch.all %}
            <li class="my-1 clearfix"><a href="{% url 'page-result-detail' link.site_domain.site.pk link.pk %}">{{link.url}} <span class="status-code status-code-{{link.latest_status_code}}" title="{{link.latest_status_code}}"></span></a> <a class="float-right badge badge-info p-2" href="{{link.url}}" target="_blank">Visit</a></li>
            {% empty %}
            <li>No outgoing links found on this page.</li>
            {% endfor %}
          </ul>
        </div>




      </div>
    </div>
  </div>


</article>
{% endblock %}