{% extends 'base.html' %}

{% block bodyclass %}{{block.super}} page-detail{% endblock %}

{% block inner %}

<nav aria-label="breadcrumb" class="my-4">
  <ol class="breadcrumb">
    <li class="breadcrumb-item"><a href="/">All Sites</a></li>
    <li class="breadcrumb-item"><a href="{% url 'site-detail' object.site_domain.site.pk %}">{{object.site_domain.site}}</a></li>
    <li class="breadcrumb-item active" aria-current="page">Page Result</li>
  </ol>
</nav>

<article class="main">
  <h1>{{object}}</h1>

  

  <div class="card text-dark">
    <div class="card-header">
      <ul class="nav nav-tabs card-header-tabs" role="tablist">
        <li class="nav-item">
          <a class="nav-link active" href="#tests" role="tab" aria-controls="description" aria-selected="true">Test Results</a>
        </li>
        <li class="nav-item">
          <a class="nav-link"  href="#request" role="tab" aria-controls="history" aria-selected="false">Request Details</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#links" role="tab" aria-controls="deals" aria-selected="false">Incoming &amp; Outgoing Links</a>
        </li>

      </ul>
    </div>
    <div class="card-body">
      
      
       <div class="tab-content mt-3">
        <div class="tab-pane active" id="tests" role="tabpanel">
          <ul class="list-unstyled">
            {% for result in object.test_results %}
            <li class="p-2 my-2 alert alert-{{result.bootstrap_class}}">
              <strong>{{result.test_title}}</strong> {{result.message}}
            </li>
            {% endfor %}

          </ul>
        </div>
         
        <div class="tab-pane" id="request" role="tabpanel" aria-labelledby="history-tab">  
          {% if object.latest_request %}
          {% if object.latest_request.response %}
          <h4>Response Path</h4>
          <ul class="list-unstyled">
          {% for response in object.response_list %}
          <li><strong>{{response.status_code}}</strong> {{response.response_url}} [{{response.content_type}} {% if response.content_length %}- {{response.content_length}}{% endif %}] </li>
          {% endfor %}
          </ul>
          {% endif %}

          <h4>Request Headers</h4>
          <dl>
          {% for header in object.latest_request.requestheader_set.all %}
            <dt>{{header.key}}</dt>
            <dd>{{header.value}}</dd>
          {% endfor %}
          </dl>

          <h4>Response Headers</h4>
          {% if object.latest_request.response %}
          <dl>
          {% for header in object.latest_request.response.responseheader_set.all %}
            <dt>{{header.key}}</dt>
            <dd>{{header.value}}</dd>
          {% endfor %}
          </dl>
          {% else %}
          <p>Page response hasn't been recorded</p>
          {% endif %}

          {% else %}
          <p>Page hasn't been loaded yet</p>
          {% endif %}

        </div>
         
        <div class="tab-pane" id="links" role="tabpanel" aria-labelledby="deals-tab">

          <h2>Incoming Links</h2>
          <ul class="list-unstyled">
            {% for link in object.incoming_links.all %}
            <li class="my-1"><a href="{% url 'page-result-detail' link.site_domain.site.pk link.pk %}">{{link.url}}</a> <a class="badge badge-info p-1" href="{{link.url}}" target="_blank">Visit ></a></li>
            {% endfor %}
          </ul>

          <h2>Outgoing Links</h2>
          <ul class="list-unstyled">
            {% for link in object.outgoing_links.all %}
            <li class="my-1"><a href="{% url 'page-result-detail' link.site_domain.site.pk link.pk %}">{{link.url}}</a> <a class="badge badge-info p-1" href="{{link.url}}" target="_blank">Visit ></a></li>
            {% endfor %}
          </ul>
          
        </div>
      </div>
    </div>
  </div>


</article>
{% endblock %}